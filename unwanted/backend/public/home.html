<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="style.css">
    <title>EXPLORE EASE | Login & Registration</title>
    <style>
        .alert {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
            display: none;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .user-info {
            display: none;
            text-align: center;
            margin-top: 20px;
        }
        .user-info h3 {
            margin-bottom: 10px;
        }
        .logout-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .logout-btn:hover {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>
 <div class="wrapper">
    <nav class="nav">
        <div class="nav-logo">
            <p>LOGO .</p>
        </div>
        <div class="nav-menu" id="navMenu">
            <ul>
                <li><a href="#" class="link active">Home</a></li>
                <li><a href="#" class="link">Services</a></li>
                <li><a href="#" class="link">About</a></li>
            </ul>
        </div>
        <div class="nav-button" id="authButtons">
            <button class="btn white-btn" id="loginBtn" onclick="login()">Sign In</button>
            <button class="btn" id="registerBtn" onclick="register()">Sign Up</button>
        </div>
        <div class="user-info" id="userInfo">
            <h3>Welcome, <span id="username"></span>!</h3>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <div class="nav-menu-btn">
            <i class="bx bx-menu" onclick="myMenuFunction()"></i>
        </div>
    </nav>

<!----------------------------- Form box ----------------------------------->    
    <div class="form-box" id="formBox">
        
        <!------------------- login form -------------------------->

        <div class="login-container" id="login">
            <div class="top">
                <span>Don't have an account? <a href="#" onclick="register()">Sign Up</a></span>
                <header>Login</header>
            </div>
            <div class="alert alert-error" id="loginError"></div>
            <div class="alert alert-success" id="loginSuccess"></div>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="input-box">
                    <input type="text" class="input-field" name="username" placeholder="Username or Email" required>
                    <i class="bx bx-user"></i>
                </div>
                <div class="input-box">
                    <input type="password" class="input-field" name="password" placeholder="Password" required>
                    <i class="bx bx-lock-alt"></i>
                </div>
                <div class="input-box">
                    <input type="submit" class="submit" value="Sign In">
                </div>
                <div class="two-col">
                    <div class="one">
                        <input type="checkbox" id="login-check" name="remember">
                        <label for="login-check"> Remember Me</label>
                    </div>
                    <div class="two">
                        <label><a href="#">Forgot password?</a></label>
                    </div>
                </div>
            </form>
        </div>

        <!------------------- registration form -------------------------->
        <div class="register-container" id="register">
            <div class="top">
                <span>Have an account? <a href="#" onclick="login()">Login</a></span>
                <header>Sign Up</header>
            </div>
            <div class="alert alert-error" id="registerError"></div>
            <div class="alert alert-success" id="registerSuccess"></div>
            <form id="registerForm" onsubmit="handleRegister(event)">
                <div class="two-forms">
                    <div class="input-box">
                        <input type="text" class="input-field" name="firstname" placeholder="Firstname" required>
                        <i class="bx bx-user"></i>
                    </div>
                    <div class="input-box">
                        <input type="text" class="input-field" name="lastname" placeholder="Lastname" required>
                        <i class="bx bx-user"></i>
                    </div>
                </div>
                <div class="input-box">
                    <input type="email" class="input-field" name="email" placeholder="Email" required>
                    <i class="bx bx-envelope"></i>
                </div>
                <div class="input-box">
                    <input type="text" class="input-field" name="username" placeholder="Username" required>
                    <i class="bx bx-user"></i>
                </div>
                <div class="input-box">
                    <input type="password" class="input-field" name="password" placeholder="Password" required>
                    <i class="bx bx-lock-alt"></i>
                </div>
                <div class="input-box">
                    <input type="password" class="input-field" name="confirm_password" placeholder="Confirm Password" required>
                    <i class="bx bx-lock-alt"></i>
                </div>
                <div class="input-box">
                    <input type="submit" class="submit" value="Register">
                </div>
                <div class="two-col">
                    <div class="one">
                        <input type="checkbox" id="register-check" name="terms" required>
                        <label for="register-check"> I agree to Terms & conditions</label>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>   

<script>
   function myMenuFunction() {
    var i = document.getElementById("navMenu");

    if(i.className === "nav-menu") {
        i.className += " responsive";
    } else {
        i.className = "nav-menu";
    }
   }
 
</script>

<script>
    var a = document.getElementById("loginBtn");
    var b = document.getElementById("registerBtn");
    var x = document.getElementById("login");
    var y = document.getElementById("register");

    function login() {
        x.style.left = "4px";
        y.style.right = "-520px";
        a.className += " white-btn";
        b.className = "btn";
        x.style.opacity = 1;
        y.style.opacity = 0;
    }

    function register() {
        x.style.left = "-510px";
        y.style.right = "5px";
        a.className = "btn";
        b.className += " white-btn";
        x.style.opacity = 0;
        y.style.opacity = 1;
    }

    // Check if user is already logged in
    document.addEventListener('DOMContentLoaded', function() {
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user'));
        
        if (token && user) {
            // User is logged in
            document.getElementById('formBox').style.display = 'none';
            document.getElementById('authButtons').style.display = 'none';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('username').textContent = user.username;
        }
    });

    // Handle login form submission
    function handleLogin(event) {
        event.preventDefault();
        const username = document.querySelector('#loginForm input[name="username"]').value;
        const password = document.querySelector('#loginForm input[name="password"]').value;
        
        // Hide any previous alerts
        document.getElementById('loginError').style.display = 'none';
        document.getElementById('loginSuccess').style.display = 'none';
        
        // Send login request to API
        fetch('/api/users/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Save token and user data
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                
                // Show success message
                document.getElementById('loginSuccess').textContent = 'Login successful! Redirecting...';
                document.getElementById('loginSuccess').style.display = 'block';
                
                // Redirect after a short delay
                setTimeout(() => {
                    document.getElementById('formBox').style.display = 'none';
                    document.getElementById('authButtons').style.display = 'none';
                    document.getElementById('userInfo').style.display = 'block';
                    document.getElementById('username').textContent = data.user.username;
                }, 1500);
            } else {
                // Show error message
                document.getElementById('loginError').textContent = data.message;
                document.getElementById('loginError').style.display = 'block';
            }
        })
        .catch(error => {
            document.getElementById('loginError').textContent = 'Login failed. Please try again.';
            document.getElementById('loginError').style.display = 'block';
            console.error('Error:', error);
        });
    }

    // Handle registration form submission
    function handleRegister(event) {
        event.preventDefault();
        const firstname = document.querySelector('#registerForm input[name="firstname"]').value;
        const lastname = document.querySelector('#registerForm input[name="lastname"]').value;
        const email = document.querySelector('#registerForm input[name="email"]').value;
        const username = document.querySelector('#registerForm input[name="username"]').value;
        const password = document.querySelector('#registerForm input[name="password"]').value;
        const confirmPassword = document.querySelector('#registerForm input[name="confirm_password"]').value;

        // Hide any previous alerts
        document.getElementById('registerError').style.display = 'none';
        document.getElementById('registerSuccess').style.display = 'none';

        if (password !== confirmPassword) {
            document.getElementById('registerError').textContent = 'Passwords do not match!';
            document.getElementById('registerError').style.display = 'block';
            return;
        }

        // Send registration request to API
        fetch('/api/users/register', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ firstname, lastname, email, username, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Save token and user data
                localStorage.setItem('token', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                
                // Show success message
                document.getElementById('registerSuccess').textContent = 'Registration successful! Redirecting...';
                document.getElementById('registerSuccess').style.display = 'block';
                
                // Redirect after a short delay
                setTimeout(() => {
                    document.getElementById('formBox').style.display = 'none';
                    document.getElementById('authButtons').style.display = 'none';
                    document.getElementById('userInfo').style.display = 'block';
                    document.getElementById('username').textContent = data.user.username;
                }, 1500);
            } else {
                // Show error message
                document.getElementById('registerError').textContent = data.message;
                document.getElementById('registerError').style.display = 'block';
            }
        })
        .catch(error => {
            document.getElementById('registerError').textContent = 'Registration failed. Please try again.';
            document.getElementById('registerError').style.display = 'block';
            console.error('Error:', error);
        });
    }

    // Handle logout
    function logout() {
        // Clear local storage
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        
        // Show login form
        document.getElementById('formBox').style.display = 'block';
        document.getElementById('authButtons').style.display = 'block';
        document.getElementById('userInfo').style.display = 'none';
        
        // Reset form fields
        document.getElementById('loginForm').reset();
        document.getElementById('registerForm').reset();
        
        // Show login form by default
        login();
    }
</script>

</body>
</html>